# Source this file to install and activate the virtual environment from scratch
VENV=.venv

CLEAN=0
UV_SYNC_EXTRA_ARGS=

# Process flags
for arg in "$@"; do
  case $arg in
        --clean)
            CLEAN=1
            ;;
        --upgrade)
            UV_SYNC_EXTRA_ARGS="$UV_SYNC_EXTRA_ARGS --upgrade"
            ;;
        *)
            echo "Unknown argument: $arg"
            echo "Usage: source ${BASH_SOURCE[0]} [--clean] [--upgrade]"
            return 1
            ;;
    esac
done

# If --clean flag is set and VENV exists, remove it
if [[ $CLEAN -eq 1 && -d $VENV ]]; then
  echo "Cleaning existing virtual environment..."
  rm -rf "$VENV"
fi

uv venv --allow-existing
source "$VENV/bin/activate"
uv sync --all-extras $UV_SYNC_EXTRA_ARGS
uv lock

pre-commit install